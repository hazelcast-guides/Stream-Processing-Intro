////
Make sure to rename this file to the name of your repository and add the filename to the README. This filename must not conflict with any existing tutorials.
////

// Describe the title of your article by replacing 'Tutorial template' with the page name you want to publish.
= Introduction to Stream Processing with Hazelcast
// Add required variables
:page-layout: tutorial
:page-product: cloud 
:page-categories: Stream Processing, SQL 
:page-lang: java, python
:page-enterprise: 
:page-est-time: 45 mins
:description: Use Hazecast Viridian to process streaming data; enrich streaming data with data in fast storage; store output in fast storage use Entry Processor to update inventory. 

{description}

// Give some context about the use case for this tutorial. What will the reader learn?
== Context

image::diagram.jpg[]

In this tutorial, you will build, step by step, a simple e-commerce order processing application. 

Step 1: Connect to the streaming data source.
Step 2: Import customer and inventory databases.
Step 3: Generate pick-and-ship order
Step 4: Generate info for money collection
Step 5: Update inventory count

// Optional: What does the reader need before starting this tutorial? Think about tools or knowledge. Delete this section if your readers can dive straight into the lesson without requiring any prerequisite knowledge.
== Before you Begin

This tutorial is designed to be completed in conjunction with the Introduction to Stream Processing with Hazelcast course. Although you can complete this tutorial independently, the course provides operational context and additional information on Hazelcast. 

Before starting this tutorial, make sure that you meet the following prerequisites:

* Set up a Hazelcast Viridian cluster
* Open a Management Center session with the Viridian cluster
* Download the repository at https://github.com/hazelcast-guides/Stream-Processing-Intro


== Step 1. Connect to the Streaming Data Source

(Insert instructions here for setting up kafka)

. blahdiblah something about generating streaming data 

+
```sql
CREATE OR REPLACE VIEW orders AS
  SELECT id,

       CASE WHEN orderRand BETWEEN 0 AND 0.2 THEN '11001'
            WHEN orderRand BETWEEN 0.2 AND 0.4 THEN '11002'
            WHEN orderRand BETWEEN 0.4 AND 0.6 THEN '11003'
            WHEN orderRand BETWEEN 0.6 AND 0.8 THEN '11004'
            ELSE '11005'
       END as cust_id, 

       CASE WHEN orderRand*1.5 BETWEEN 0 AND 0.25 THEN '501'
            WHEN orderRand*1.5 BETWEEN 0.25 AND 0.5 THEN '502'
            WHEN orderRand*1.5 BETWEEN 0.5 AND 0.75 THEN '503'
            ELSE '504'
       END as item_num,

       CASE WHEN orderRand*.66 BETWEEN 0 AND .25 THEN CAST(1 AS SMALLINT)
            WHEN orderRand*.66 BETWEEN .25 AND .5 THEN CAST(2 AS SMALLINT)
            ELSE CAST(3 AS SMALLINT)
       END as quantity,
       order_ts
FROM
    (SELECT v as id,
           RAND(v*v) as orderRand,
           TO_TIMESTAMP_TZ(v*10 + 1645484400000) as order_ts
     FROM TABLE(generate_stream(15))); 
```

== Step 2. Query Streaming Data

////
Continue the design approach you chose in the previous part and continue it through to the end of the tutorial.
////

== Step 3. Load Fast Data Store

```sql
CREATE or REPLACE MAPPING customers (
     __key BIGINT,
     cust_id VARCHAR,
     last_name VARCHAR,
     first_name VARCHAR,
     address1 VARCHAR,
     address2 VARCHAR,
     phone VARCHAR )
TYPE IMap
OPTIONS (
'keyFormat'='bigint',
'valueFormat'='json-flat');
```

```sql
INSERT INTO customers VALUES
(1, 11001, 'Smith', 'John', '123 Main St', 'Ames, IA 50012', '515-555-1212'),
(2, 11002, 'Li', 'Guo', '456 Powell St', 'San Francisco, CA 94108', '415-555-1212'),
(3, 11003, 'Ivanov', 'Sergei', '999 Brighton Blvd', 'New York, NY 11235','212-555-1212'),
(4, 11004, 'Mohammed', 'Ibrahim', '42 Elm St', 'Dearborn, MI 48126', '313-555-1212'),
(5, 11005, 'Patel', 'Ram', '5151 Market St', 'Trenton, NJ 08615', '609-555-1212');
```

```sql
CREATE or REPLACE MAPPING inventory (
     __key BIGINT,
     item_num VARCHAR,
     unit_price DECIMAL,
     quantity SMALLINT)
TYPE IMap
OPTIONS (
'keyFormat'='bigint',
'valueFormat'='json-flat');
```

```sql
INSERT INTO inventory VALUES
(1, '501', 1.99, 500),
(2, '502', 3.99, 500),
(3, '503', 5.99, 500),
(4, '504', 7.99, 500);
```

== Step 4: Generate Warehouse Pick Order

. In order to ensure that data is included in the correct window, you have to first create a new view that orders the data based on one of the data fields (the watermark). In this tutorial, weâ€™ll use timestamp as the watermark.

```sql
CREATE OR REPLACE MAPPING PickOrder (
     __key BIGINT,
     ts TIMESTAMP,
     item_num VARCHAR,
     quantity SMALLINT,
     cust_id VARCHAR,
     last_name VARCHAR,
     first_name VARCHAR,
     address1 VARCHAR,
     address2 VARCHAR,
     phone VARCHAR)
TYPE IMap
OPTIONS (
'keyFormat'='bigint',
'valueFormat'='json-flat');

```

```sql
CREATE OR REPLACE VIEW ProcessStatus AS
     SELECT
          ord.item_num,
          ord.quantity,
          inv.quantity,
          CASE
               WHEN (ord.quantity > inv.quantity) THEN 'Unable to process'
               ELSE 'Processing'
     END AS status
     FROM orders AS ord
     JOIN inventory AS inv
     ON ord.item_num = inv.item_num;
```

```sql
INSERT INTO PickOrder
     SELECT 
          ord.id AS __key,
          ord.order_ts AS ts,
          ord.item_num AS item_num,
          ord.quantity AS quantity,
          ord.cust_id AS cust_id,
          cust.last_name AS last_name,
          cust.first_name AS first_name,
          cust.address1 AS address1,
          cust.address2 AS address2,
          cust.phone AS phone
     FROM orders AS ord
     JOIN customers AS cust ON ord.cust_id = cust.cust_id
     JOIN inventory ON ord.item_num = inventory.item_num
     WHERE ord.quantity < inventory.quantity;
```




== Step 5: Generate Order Total

== Step 6: Update Inventory


== Summary

////
Summarise what knowledge the reader has gained by completing the tutorial, including a summary of each step's goals (this is a good way to validate whether your tutorial has covered all you need it to.)
////


== See Also

// Optionally, add some links to resources, such as other related guides.
